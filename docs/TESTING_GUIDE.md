# 프로덕션 배포 전 테스트 가이드

이 문서는 프로덕션 환경으로 전환하기 전에 수행해야 할 테스트 항목과 방법을 안내합니다.

## 1. 기능 테스트

### 1.1 에이전트 역할 테스트

#### 테스트 계정 준비

- Clerk 대시보드에서 에이전트 역할을 가진 테스트 계정 생성
- 또는 기존 에이전트 계정 사용

#### 테스트 항목

**대시보드 접근**

- [ ] `/agent/dashboard` 페이지 접근 가능
- [ ] 자신의 클라이언트 목록이 표시됨
- [ ] 할당되지 않은 클라이언트 목록이 표시됨

**클라이언트 관리**

- [ ] 새 클라이언트 생성 가능
- [ ] 자신의 클라이언트 정보 수정 가능
- [ ] 할당되지 않은 클라이언트를 자신에게 할당 가능
- [ ] 다른 에이전트의 클라이언트에 접근 불가능

**주거 요구사항 관리**

- [ ] 자신의 클라이언트의 주거 요구사항 조회 가능
- [ ] 자신의 클라이언트의 주거 요구사항 수정 가능
- [ ] 다른 에이전트의 클라이언트 주거 요구사항에 접근 불가능

**체크리스트 관리**

- [ ] 자신의 클라이언트의 체크리스트 조회 가능
- [ ] 자신의 클라이언트의 체크리스트 항목 수정 가능
- [ ] 다른 에이전트의 클라이언트 체크리스트에 접근 불가능

**메시지/채팅**

- [ ] 자신의 클라이언트와 메시지 주고받기 가능
- [ ] 다른 에이전트의 클라이언트와 메시지 주고받기 불가능

**문서 관리**

- [ ] 자신의 클라이언트의 문서 조회 가능
- [ ] 자신의 클라이언트의 문서 업로드 가능
- [ ] 자신의 클라이언트의 문서 삭제 가능
- [ ] 다른 에이전트의 클라이언트 문서에 접근 불가능

**가족 구성원 및 비상연락망**

- [ ] 자신의 클라이언트의 가족 구성원 조회/수정/삭제 가능
- [ ] 자신의 클라이언트의 비상연락망 조회/수정/삭제 가능

### 1.2 클라이언트 역할 테스트

#### 테스트 계정 준비

- Clerk 대시보드에서 클라이언트 역할을 가진 테스트 계정 생성
- 또는 기존 클라이언트 계정 사용

#### 테스트 항목

**홈 페이지 접근**

- [ ] `/client/home` 페이지 접근 가능
- [ ] 자신의 프로필 정보가 표시됨

**프로필 관리**

- [ ] 자신의 프로필 정보 조회 가능
- [ ] 자신의 프로필 정보 수정 가능
- [ ] 다른 클라이언트의 프로필에 접근 불가능

**주거 요구사항 관리**

- [ ] 자신의 주거 요구사항 조회 가능
- [ ] 자신의 주거 요구사항 수정 가능
- [ ] 다른 클라이언트의 주거 요구사항에 접근 불가능

**체크리스트 관리**

- [ ] 자신의 체크리스트 조회 가능
- [ ] 자신의 체크리스트 항목 수정 가능
- [ ] 체크리스트 파일 업로드 가능
- [ ] 체크리스트 파일 삭제 가능
- [ ] 다른 클라이언트의 체크리스트에 접근 불가능

**메시지/채팅**

- [ ] 자신의 에이전트와 메시지 주고받기 가능
- [ ] 다른 클라이언트의 메시지에 접근 불가능

**문서 관리**

- [ ] 자신의 문서 조회 가능
- [ ] 자신의 문서 업로드 가능
- [ ] 자신의 문서 삭제 가능
- [ ] 다른 클라이언트의 문서에 접근 불가능

**가족 구성원 및 비상연락망**

- [ ] 자신의 가족 구성원 조회/수정/삭제 가능
- [ ] 자신의 비상연락망 조회/수정/삭제 가능

### 1.3 비로그인 사용자 테스트

- [ ] 보호된 페이지 접근 시 로그인 페이지로 리다이렉트
- [ ] 공개 API 엔드포인트 접근 시 인증 오류 반환

## 2. RLS 정책 테스트

### 2.1 데이터 격리 테스트

#### 테스트 시나리오

**에이전트 A와 에이전트 B 생성**

1. 두 개의 서로 다른 에이전트 계정 생성
2. 각 에이전트가 자신의 클라이언트 생성
3. 에이전트 A가 에이전트 B의 클라이언트에 접근 시도
4. 접근이 차단되는지 확인

**클라이언트 A와 클라이언트 B 생성**

1. 두 개의 서로 다른 클라이언트 계정 생성
2. 각 클라이언트가 자신의 데이터 생성
3. 클라이언트 A가 클라이언트 B의 데이터에 접근 시도
4. 접근이 차단되는지 확인

#### 테스트 방법

**Supabase SQL Editor에서 직접 테스트**

```sql
-- 에이전트 A의 Clerk User ID로 로그인한 상태에서
-- 에이전트 B의 클라이언트 ID로 접근 시도
SELECT * FROM public.clients WHERE id = '에이전트_B의_클라이언트_ID';
-- 결과: 빈 결과셋이 반환되어야 함 (RLS 정책에 의해 차단)

-- 클라이언트 A의 Clerk User ID로 로그인한 상태에서
-- 클라이언트 B의 데이터에 접근 시도
SELECT * FROM public.clients WHERE id = '클라이언트_B의_ID';
-- 결과: 빈 결과셋이 반환되어야 함 (RLS 정책에 의해 차단)
```

**애플리케이션에서 테스트**

- 브라우저 개발자 도구의 Network 탭에서 API 요청 확인
- 다른 사용자의 데이터를 조회하려는 요청이 403 또는 빈 결과를 반환하는지 확인

### 2.2 Storage RLS 정책 테스트

**파일 업로드 테스트**

- [ ] 자신의 폴더(`{clerk_user_id}/`)에 파일 업로드 가능
- [ ] 다른 사용자의 폴더에 파일 업로드 불가능
- [ ] 자신의 파일 조회 가능
- [ ] 다른 사용자의 파일 조회 불가능
- [ ] 자신의 파일 삭제 가능
- [ ] 다른 사용자의 파일 삭제 불가능

## 3. 입력 검증 테스트

### 3.1 API 입력 검증 테스트

**잘못된 입력 테스트**

- [ ] 잘못된 UUID 형식 전송 시 400 에러 반환
- [ ] 필수 필드 누락 시 400 에러 반환
- [ ] 최대 길이 초과 시 400 에러 반환
- [ ] 잘못된 이메일 형식 시 400 에러 반환
- [ ] 잘못된 날짜 형식 시 400 에러 반환

**파일 업로드 검증 테스트**

- [ ] 허용되지 않는 파일 타입 업로드 시 에러 반환
- [ ] 파일 크기 제한 초과 시 에러 반환
- [ ] 파일명에 특수 문자 포함 시 sanitization 확인

## 4. 성능 테스트

### 4.1 대량 데이터 테스트

- [ ] 많은 클라이언트가 있는 에이전트의 대시보드 로딩 시간 확인
- [ ] 많은 메시지가 있는 채팅방의 메시지 로딩 시간 확인
- [ ] 많은 체크리스트 항목이 있는 클라이언트의 체크리스트 로딩 시간 확인

### 4.2 동시성 테스트

- [ ] 여러 사용자가 동시에 같은 리소스에 접근할 때 정상 작동 확인
- [ ] 동시에 여러 파일 업로드 시 정상 작동 확인

## 5. 보안 테스트

### 5.1 인증/인가 테스트

- [ ] 만료된 토큰으로 접근 시 401 에러 반환
- [ ] 잘못된 토큰으로 접근 시 401 에러 반환
- [ ] 권한이 없는 역할로 접근 시 403 에러 반환

### 5.2 SQL Injection 테스트

- [ ] 입력 필드에 SQL 코드 삽입 시도
- [ ] Supabase 클라이언트가 자동으로 이스케이프 처리하는지 확인

### 5.3 XSS 테스트

- [ ] 입력 필드에 스크립트 코드 삽입 시도
- [ ] React가 자동으로 이스케이프 처리하는지 확인

## 6. 테스트 체크리스트 요약

### 필수 테스트 항목

- [ ] 에이전트 역할로 모든 주요 기능 테스트
- [ ] 클라이언트 역할로 모든 주요 기능 테스트
- [ ] RLS 정책 테스트 (다른 사용자 데이터 접근 불가 확인)
- [ ] 입력 검증 테스트 (잘못된 입력 처리 확인)
- [ ] 인증/인가 테스트 (권한 없는 접근 차단 확인)

### 선택적 테스트 항목

- [ ] 성능 테스트 (대량 데이터, 동시성)
- [ ] 보안 테스트 (SQL Injection, XSS)

## 7. 테스트 결과 기록

테스트를 수행한 후 다음 정보를 기록하세요:

- 테스트 날짜: ****\_\_\_****
- 테스트 수행자: ****\_\_\_****
- 테스트 환경: ****\_\_\_****
- 발견된 문제: ****\_\_\_****
- 해결 방법: ****\_\_\_****

## 8. 문제 발견 시 대응

테스트 중 문제를 발견한 경우:

1. 문제를 상세히 기록 (재현 단계 포함)
2. 문제의 심각도 평가 (Critical, High, Medium, Low)
3. 문제 해결 우선순위 결정
4. 문제 해결 후 재테스트 수행
