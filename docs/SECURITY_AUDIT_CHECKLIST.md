# 보안 점검 체크리스트

## 자동화된 보안 점검

### 1. Supabase 보안 어드바이저 실행

```bash
# MCP를 통해 실행
mcp_supabase_get_advisors(type: "security")
```

**확인 사항:**
- [ ] RLS가 모든 테이블에서 활성화되어 있음
- [ ] RLS 정책이 올바르게 설정되어 있음
- [ ] PostgreSQL 함수에 search_path가 설정되어 있음
- [ ] 보안 경고가 0개

### 2. 의존성 취약점 스캔

```bash
pnpm audit
```

**확인 사항:**
- [ ] Critical 취약점 없음
- [ ] High 취약점 없음 (또는 수용 가능한 수준)

### 3. 정적 코드 분석

```bash
pnpm lint
```

**확인 사항:**
- [ ] 린터 에러 없음
- [ ] 타입 에러 없음

## 수동 보안 점검

### 인증 및 인가

- [ ] 모든 보호된 라우트가 Middleware에서 보호됨
- [ ] 모든 API 라우트가 인증을 확인함
- [ ] 역할 기반 접근 제어가 올바르게 작동함
- [ ] 클라이언트 소유권 확인이 모든 관련 API에서 수행됨

### 데이터베이스 보안

- [ ] 모든 테이블에 RLS가 활성화되어 있음
- [ ] RLS 정책이 올바르게 작동함
- [ ] Service Role Key가 클라이언트에 노출되지 않음
- [ ] 데이터베이스 함수에 search_path가 설정되어 있음

### 입력 검증

- [ ] 모든 API 라우트에 Zod 스키마가 적용됨
- [ ] UUID 형식 검증이 수행됨
- [ ] 파일 업로드 크기/타입 제한이 적용됨
- [ ] 파일명 sanitization이 적용됨

### 파일 업로드 보안

- [ ] 파일 크기 제한이 적용됨 (10MB)
- [ ] 허용된 파일 타입만 업로드 가능
- [ ] 파일명 sanitization이 적용됨
- [ ] Storage RLS 정책이 올바르게 작동함

### 환경 변수 보안

- [ ] Service Role Key가 서버 사이드에서만 사용됨
- [ ] API 키가 서버 사이드에서만 사용됨
- [ ] 환경 변수가 `.gitignore`에 포함되어 있음
- [ ] 프로덕션 환경 변수가 안전하게 설정됨

### 보안 헤더

- [ ] Content-Security-Policy가 설정됨
- [ ] X-Frame-Options가 설정됨
- [ ] X-Content-Type-Options가 설정됨
- [ ] Strict-Transport-Security가 설정됨

### 로깅 및 모니터링

- [ ] 보안 이벤트 로깅이 구현됨
- [ ] 인증 실패가 로깅됨
- [ ] 권한 위반이 로깅됨
- [ ] 에러 로깅 시스템이 설정됨 (Sentry 등)

## 침투 테스트

### 인증 우회 시도

- [ ] 인증 없이 보호된 API 접근 시도 → 401 반환 확인
- [ ] 잘못된 토큰으로 접근 시도 → 401 반환 확인
- [ ] 만료된 토큰으로 접근 시도 → 401 반환 확인

### 권한 상승 시도

- [ ] 클라이언트 역할로 에이전트 전용 API 접근 시도 → 403 반환 확인
- [ ] 에이전트 역할로 클라이언트 전용 API 접근 시도 → 403 반환 확인
- [ ] 다른 사용자의 데이터 접근 시도 → 404 또는 403 반환 확인

### SQL 인젝션 시도

- [ ] API 파라미터에 SQL 코드 삽입 시도 → 검증 실패 확인
- [ ] UUID 필드에 SQL 코드 삽입 시도 → 검증 실패 확인

### XSS 공격 시도

- [ ] 입력 필드에 스크립트 태그 삽입 시도 → sanitization 확인
- [ ] 메시지에 악성 스크립트 삽입 시도 → sanitization 확인

### 파일 업로드 공격 시도

- [ ] 실행 가능한 파일 업로드 시도 → 타입 검증 실패 확인
- [ ] 큰 파일 업로드 시도 → 크기 제한 확인
- [ ] 경로 탐색 공격 시도 (../) → sanitization 확인

### CSRF 공격 시도

- [ ] Clerk가 CSRF 보호를 제공하는지 확인
- [ ] API 라우트가 CSRF 토큰을 확인하는지 확인 (필요한 경우)

## 성능 및 안정성

- [ ] 데이터베이스 쿼리가 효율적으로 실행됨
- [ ] 인덱스가 적절히 설정되어 있음
- [ ] RLS 정책이 성능에 큰 영향을 주지 않음
- [ ] 에러 처리가 올바르게 작동함

## 문서화

- [ ] 보안 설정이 문서화되어 있음
- [ ] 프로덕션 전환 가이드가 작성되어 있음
- [ ] 환경 변수 가이드가 작성되어 있음
- [ ] 보안 이벤트 로깅 가이드가 작성되어 있음

## 최종 확인

- [ ] 모든 보안 경고가 해결됨
- [ ] 모든 테스트가 통과함
- [ ] 프로덕션 환경 변수가 설정됨
- [ ] 모니터링 시스템이 작동함
- [ ] 백업이 설정됨

