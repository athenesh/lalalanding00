<!-- 72f3d90c-52e2-4a0a-a694-e7e5adf4097b 6568a50b-441b-44a1-adde-01f6937e8938 -->
# 클라이언트용 체크리스트 API 구현

## 목표

클라이언트가 자신의 체크리스트를 조회하고 저장할 수 있도록 API 구현. 에이전트가 클라이언트의 체크리스트를 확인할 수 있도록 기존 API와 연동.

## 현재 상황

- ✅ 에이전트용 체크리스트 API 구현 완료
  - GET /api/checklist/[client_id] - 조회
  - PATCH /api/checklist/[client_id] - 업데이트
- ✅ ChecklistTab 컴포넌트는 `onSave` prop을 받을 수 있음
- ❌ 클라이언트용 체크리스트 API 미구현
- ❌ 클라이언트 페이지에서 체크리스트 데이터 로드/저장 로직 없음

## 구현 계획

### 1. 클라이언트용 체크리스트 API 생성

- `/api/client/checklist/route.ts` 생성
- GET: 클라이언트 자신의 체크리스트 조회
  - `requireClient()`로 클라이언트 권한 확인
  - `clerk_user_id`로 클라이언트 조회 후 `client_id` 획득
  - `checklist_items` 테이블에서 데이터 조회
  - category별로 그룹화하여 반환 (에이전트용과 동일한 구조)
- PATCH: 클라이언트 자신의 체크리스트 저장/업데이트
  - 여러 항목을 한 번에 업데이트
  - `completed`, `notes`, `referenceUrl`, `completedAt` 업데이트
  - 에이전트용 API와 동일한 요청/응답 구조

### 2. 클라이언트 페이지 수정

- `app/client/home/page.tsx` 수정:
  - `checklistData` 상태 추가 (ChecklistCategory[] 타입)
  - `isLoadingChecklist` 상태 추가
  - `loadChecklistData` 함수 구현:
    - `/api/client/checklist` GET 호출
    - 응답 데이터를 UI 형식으로 변환
    - `checklistData` 상태 업데이트
  - `handleSaveChecklist` 함수 구현:
    - `/api/client/checklist` PATCH 호출
    - 저장 후 데이터 다시 로드
    - Toast 알림 표시
  - `ChecklistTab`에 `initialData={checklistData}`와 `onSave={handleSaveChecklist}` prop 전달
  - 로딩 상태에 따른 UI 처리

### 3. 데이터 변환 로직

- **조회 시 (DB → UI)**:
  - `is_completed` → `completed` (boolean)
  - `notes` → `notes` (string | undefined)
  - `reference_url` → `referenceUrl` (string | undefined)
  - `completed_at` → `completedAt` (Date | undefined)
  - `description` (string) → `description` (string[]) - JSON 파싱 또는 split 처리
  - category별로 그룹화하여 ChecklistCategory[] 형태로 변환
- **저장 시 (UI → DB)**:
  - `completed` → `is_completed` (boolean)
  - `notes` → `notes` (string | null)
  - `referenceUrl` → `reference_url` (string | null)
  - `completedAt` → `completed_at` (ISO string | null)
  - 여러 항목을 배열로 전송

### 4. 체크리스트 템플릿 데이터

- 체크리스트 항목은 템플릿에서 생성되어야 함
- 클라이언트가 처음 조회할 때 체크리스트 항목이 없을 수 있음
- 이 경우 빈 배열 반환 또는 템플릿에서 자동 생성 (향후 구현)

## 수정/생성 파일

- `app/api/client/checklist/route.ts` (신규 생성)
- `app/client/home/page.tsx` (수정)

## 참고 패턴

- `app/api/client/housing/route.ts` - 클라이언트용 API 패턴
- `app/api/checklist/[client_id]/route.ts` - 에이전트용 체크리스트 API (데이터 구조 참고)
- `app/agent/client/[id]/page.tsx` - 에이전트 페이지의 체크리스트 처리 로직 (데이터 변환 참고)

## 데이터 구조

### 요청 (PATCH)

```json
{
  "items": [
    {
      "id": "uuid",
      "completed": true,
      "notes": "완료했습니다",
      "referenceUrl": "https://example.com",
      "completedAt": "2025-01-27T00:00:00Z"
    }
  ]
}
```

### 응답 (GET)

```json
{
  "checklist": [
    {
      "id": "uuid",
      "title": "국제운전면허증 발급",
      "is_completed": false,
      "notes": null,
      "reference_url": null,
      "completed_at": null,
      "category": "pre_departure",
      "order_num": 1
    }
  ],
  "groupedByCategory": {
    "pre_departure": [...],
    "arrival": [...],
    "settlement": [...]
  }
}
```

### To-dos

- [ ] 현재 구현된 API 목록 문서화 완료
- [ ] 트러블슈팅 방법론 문서화 완료
- [ ] 에러 없는 API 개발 프로세스 문서화 완료